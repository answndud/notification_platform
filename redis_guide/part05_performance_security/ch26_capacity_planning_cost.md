# Chapter 26 - 용량 계획과 비용

- 상태: 초안 완료
- 목표 분량: 9쪽

## 학습 목표

- 메모리 용량 산정의 기본 공식을 이해할 수 있다.
- 성능 여유율과 비용 균형을 설계할 수 있다.
- 확장 시점 판단 기준을 세울 수 있다.

## 핵심 개념

Redis 비용은 메모리 사용량과 인스턴스 운영 방식에서 크게 결정됩니다.
따라서 기능 도입 전 용량 계획이 필요합니다.

용량 계획은 단순 평균 계산이 아니라
"피크 시 안전 여유를 확보하는 리스크 관리"입니다.
평균만 기준으로 잡으면 트래픽 급등 시 eviction과 지연이 동시에 발생합니다.

기본 산정 요소:

- 평균 키 크기
- 키 개수
- 자료구조 오버헤드
- 복제 배수
- 여유율(보통 20~30%)

실무에서는 아래를 추가로 고려합니다.

- 키 증가율(월별/분기별)
- 만료 분포(동시 만료 위험)
- 재시도/배치 작업에 의한 순간 부하

## 실무 계산 접근

1. 상위 10개 키군을 분류
2. 키군별 예상 개수와 TTL 정의
3. 피크 트래픽 기준 메모리/OPS 추정
4. 복제와 장애 여유 포함 최종 용량 산출

간단 계산 예시:

- 키군 A: 50바이트 * 500만개 = 250MB(순수 데이터)
- 오버헤드/단편화/복제/여유율 반영 시 실제 필요량은 훨씬 커질 수 있음

따라서 PoC 측정치와 운영 지표를 결합한 보정이 필수입니다.

## 설계 포인트

- maxmemory 정책을 서비스 성격에 맞게 설정
- eviction 발생 시 사용자 영향도를 미리 정의
- 비용 절감은 TTL/키 구조 최적화가 우선

eviction 정책 해석 포인트:

- `allkeys-lru`: 일반 캐시에 자주 사용
- `volatile-*`: TTL 키 중심 축출
- 정책 선택은 "어떤 키를 잃어도 되는가" 질문에서 시작

## 자주 하는 실수

1. 데이터 증가율 예측 없이 현재 트래픽만 기준으로 산정
2. 복제 비용을 누락
3. eviction 정책을 이해하지 않고 기본값 사용
4. 메모리 단편화와 백그라운드 작업 부하를 무시

## 요약

- 용량 계획은 메모리 숫자 계산이 아니라 서비스 리스크 관리다.
- 키 설계와 TTL 최적화가 비용 절감의 첫 단계다.

## 연습문제

### 기초

1. 키군 3개를 가정해 메모리 용량을 계산해보세요.
2. 여유율이 필요한 이유를 설명해보세요.

### 응용

1. 향후 6개월 트래픽 증가를 반영한 증설 계획을 작성해보세요.
2. eviction 발생 시 단계별 대응 절차를 설계해보세요.

## 챕터 체크리스트

- [x] 초안 작성 완료
- [ ] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
