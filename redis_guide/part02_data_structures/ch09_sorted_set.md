# Chapter 09 - Sorted Set 자료형

- 상태: 초안 완료
- 목표 분량: 11쪽

## 학습 목표

- Sorted Set의 score 기반 정렬 원리를 이해한다.
- 랭킹/리더보드/시간 기반 조회에 적용할 수 있다.
- score 설계 시 주의점을 설명할 수 있다.

## 핵심 개념

Sorted Set은 멤버마다 score를 붙여 정렬하는 자료형입니다.
중복 멤버는 허용하지 않으며 score 업데이트가 가능합니다.

Sorted Set의 강점은 "정렬된 조회"를 별도 인덱스 없이 바로 수행한다는 점입니다.
즉, 랭킹/우선순위/시간축 조회를 애플리케이션 정렬 없이 처리할 수 있습니다.

주요 명령:

- `ZADD`, `ZREM`, `ZSCORE`
- `ZRANGE`, `ZREVRANGE`
- `ZRANK`, `ZREVRANK`

## 실습 예제

```bash
redis-cli -p 6380 DEL rank:game:season1
redis-cli -p 6380 ZADD rank:game:season1 120 user1 200 user2 180 user3
redis-cli -p 6380 ZREVRANGE rank:game:season1 0 2 WITHSCORES
redis-cli -p 6380 ZREVRANK rank:game:season1 user3
```

## 설계 포인트

- score를 시간으로 쓰면 타임라인 정렬 구현 가능
- 동점 처리 규칙(멤버 문자열 정렬)을 사전에 이해해야 함
- 매우 큰 랭킹은 페이지 조회 전략 필요

score 설계 실무 팁:

- 시간 기반이면 단위를 통일(초 또는 밀리초)
- 금액/점수면 정수 스케일링 규칙 정의(소수 처리 혼란 방지)
- 여러 기준(예: 점수+시간)이 필요하면 보조 키나 복합 score 규칙을 문서화

운영 팁:

- 시즌/기간 단위 키 분리(`rank:game:2026w08`)
- 만료 가능한 랭킹은 TTL 적용
- 상위 N 조회와 주변 순위 조회 API를 구분 설계

## 자주 하는 실수

1. score 단위를 섞어서 저장(초/밀리초 혼용)
2. 범위 조회를 과도하게 크게 요청
3. 시즌 분리 없이 한 키에 영구 누적

## 요약

- Sorted Set은 정렬 + 조회를 동시에 제공하는 강력한 자료형이다.
- 랭킹, 타임라인, 우선순위 큐에 특히 유용하다.
- score 규칙과 키 분할 정책이 품질을 좌우한다.

## 연습문제

### 기초

1. 상위 10명 조회 쿼리를 작성해보세요.
2. 특정 사용자 순위를 조회해보세요.

### 응용

1. 일간/주간 랭킹 분리 키 설계를 작성해보세요.
2. 동점 처리 정책을 제품 요구사항으로 정의해보세요.

## 챕터 체크리스트

- [x] 초안 작성 완료
- [x] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
