# Chapter 17 - RDB/AOF와 내구성 설계

- 상태: 초안 완료
- 목표 분량: 11쪽

## 학습 목표

- RDB/AOF 내구성 차이를 운영 관점에서 설명할 수 있다.
- fsync 정책의 의미를 이해할 수 있다.
- 장애 복구 목표(RPO/RTO)에 맞춰 설정을 선택할 수 있다.

## 핵심 개념

내구성은 "장애가 나도 데이터를 얼마나 보전하는가"의 문제입니다.
Redis에서는 RDB와 AOF 조합으로 내구성 수준을 조절합니다.

내구성 설계는 설정 튜닝이 아니라 비즈니스 결정입니다.
"몇 초 유실까지 허용하는가"가 먼저 정해져야,
그 다음에 `appendfsync` 같은 기술 설정을 선택할 수 있습니다.

### RPO/RTO

- RPO(Recovery Point Objective): 유실 허용 범위
- RTO(Recovery Time Objective): 복구 허용 시간

## AOF fsync 정책 요약

- `always`: 가장 안전하지만 성능 비용 큼
- `everysec`: 일반적 균형점
- `no`: OS에 위임, 성능은 좋지만 손실 위험 큼

실무에서 자주 쓰는 기준:

- 일반 서비스: `everysec`를 기본값으로 시작
- 극단적 유실 민감 구간: 별도 저장소 이중화 포함해 설계
- 캐시 전용: 내구성 강도 낮추고 성능/비용 최적화 가능

## 실습 예제

```bash
redis-cli -p 6380 CONFIG GET appendonly
redis-cli -p 6380 CONFIG GET appendfsync
redis-cli -p 6380 INFO persistence
```

## 설계 포인트

- 인증/결제 등 중요 경로는 유실 허용 범위를 명확히 정의
- 캐시 중심 워크로드는 성능 우선 정책 가능
- 설정 변경 전후 부하 테스트와 복구 테스트를 함께 수행

복구 전략 체크리스트:

- 장애 발생 시 어떤 시점까지 복구되는지 즉시 설명 가능한가
- 복구 후 데이터 검증 쿼리가 준비되어 있는가
- RDB/AOF 파일 보관 및 접근 권한이 통제되는가

## 자주 하는 실수

1. RPO/RTO를 정의하지 않고 설정만 조정
2. 복구 시나리오를 문서화하지 않음
3. persistence 지표를 관찰하지 않음

## 요약

- 내구성은 설정 값이 아니라 복구 목표로 결정해야 한다.
- RDB/AOF 선택은 데이터 성격과 SLA에 맞춰 조합한다.

## 연습문제

### 기초

1. 현재 인스턴스의 AOF 설정을 확인해보세요.
2. `everysec` 정책의 장단점을 적어보세요.

### 응용

1. 서비스별 RPO/RTO 기준표를 만들어보세요.
2. 장애 복구 리허설 시나리오를 작성해보세요.

## 챕터 체크리스트

- [x] 초안 작성 완료
- [x] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
