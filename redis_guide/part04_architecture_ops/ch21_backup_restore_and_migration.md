# Chapter 21 - 백업, 복구, 마이그레이션

- 상태: 초안 완료
- 목표 분량: 11쪽

## 학습 목표

- Redis 백업 정책의 기본 요소를 정리할 수 있다.
- 복구 리허설 절차를 설계할 수 있다.
- 마이그레이션 시 다운타임/리스크를 줄일 수 있다.

## 핵심 개념

백업은 "파일 보관"이 아니라 "복구 가능성 보장"입니다.
Redis에서도 백업 파일만 있어서는 충분하지 않고,
복구 테스트가 병행되어야 의미가 있습니다.

실무에서 백업 실패보다 더 위험한 것은
"백업은 있는데 복구가 안 되는 상태"입니다.
그래서 백업 정책과 복구 정책은 항상 한 세트로 설계합니다.

### 백업 유형을 구분해서 생각하기

- 데이터 백업: RDB/AOF 파일 보존
- 구성 백업: Redis 설정, Sentinel/Cluster 설정
- 운영 백업: 런북, 점검 스크립트, 복구 체크리스트

데이터만 보관하고 구성/절차를 잃으면
복구 시간(RTO)이 예상보다 크게 증가합니다.

## 직관 그림

```mermaid
flowchart LR
  B[백업 생성] --> S[안전 저장소 보관]
  S --> R[격리 환경 복구]
  R --> V[무결성/기능 검증]
  V --> D[리허설 기록/개선]
```

```text
백업 성공 != 복구 성공

백업 파일 존재 O
복구 절차 문서 O
실제 복구 리허설 X   -> 운영 위험 높음
```

핵심 해석:
- 백업은 결과물이 아니라 "복구 가능성"을 증명해야 완성됩니다.
- 리허설 기록이 없으면 RTO/RPO 수치는 신뢰하기 어렵습니다.

## 백업 정책 요소

- 백업 주기
- 보관 기간
- 암호화/접근 통제
- 오프사이트 저장
- 복구 점검 주기

## 복구 리허설 기본 절차

1. 특정 시점 백업 선택
2. 격리 환경에 복구
3. 데이터 무결성 확인
4. 애플리케이션 연결 점검
5. 복구 시간(RTO) 측정 기록

권장 추가 단계:

6. 기능 시나리오 검증(로그인/조회/핵심 API)
7. 복구 후 데이터 샘플 정합성 점검
8. 리허설 회고(막힌 지점, 자동화 후보) 기록

## 마이그레이션 포인트

- 키 스키마 변경은 버전 전략과 병행
- 대량 이동은 배치/증분 방식 검토
- cutover 시점 모니터링 계획 필수

마이그레이션 전략 선택 예시:

- 블루/그린: 안정적 전환, 인프라 비용 증가
- 증분 동기화: 다운타임 최소화, 구현 복잡도 증가
- 일괄 전환: 단순하지만 cutover 리스크 큼

어떤 전략이든 롤백 기준(언제 되돌릴지)과
롤백 절차(어떻게 되돌릴지)를 사전에 문서화해야 합니다.

## 설계 포인트

- 복구 성공 기준(정상 판정 조건)을 수치로 정의
- 백업 무결성 검증(파일 손상/암호화 키 접근) 자동화
- 분기별 1회 이상 복구 드릴을 운영 KPI로 관리

## 자주 하는 실수

1. 백업 파일 생성만 확인하고 복구를 검증하지 않음
2. 마이그레이션 범위 산정 없이 작업 시작
3. 롤백 계획 부재

## 요약

- 백업의 목적은 "복구 성공"이다.
- 마이그레이션은 사전 체크리스트와 롤백 전략이 핵심이다.

## 초보자 체크

- 백업 정책과 복구 정책을 왜 한 세트로 설계해야 하는지 설명할 수 있는가?
- cutover 전에 롤백 기준을 문서화해야 하는 이유를 말할 수 있는가?

## 연습문제

### 기초

1. 백업 정책 표준 항목을 작성해보세요.
2. 복구 테스트 체크리스트 10개를 만들어보세요.

### 응용

1. 키 스키마 v1->v2 이전 계획을 단계별로 작성해보세요.
2. cutover 실패 시 롤백 절차를 설계해보세요.

## 챕터 체크리스트

- [x] 초안 작성 완료
- [ ] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
