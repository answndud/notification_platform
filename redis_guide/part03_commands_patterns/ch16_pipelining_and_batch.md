# Chapter 16 - 파이프라이닝과 배치 처리

- 상태: 초안 완료
- 목표 분량: 11쪽

## 학습 목표

- 파이프라이닝의 성능 효과를 설명할 수 있다.
- 배치 처리에서 적절한 청크 크기를 결정할 수 있다.
- 처리량과 메모리 사용 간 균형점을 찾을 수 있다.

## 핵심 개념

Redis에서 지연의 큰 원인은 네트워크 왕복(RTT)입니다.
파이프라이닝은 여러 명령을 묶어 보내 왕복 횟수를 줄입니다.

예를 들어 1000개 키를 순차 저장하면 1000번 왕복이 필요하지만,
파이프라이닝을 쓰면 훨씬 적은 왕복으로 처리할 수 있습니다.
이 차이가 고지연 네트워크에서 특히 크게 나타납니다.

효과:

- 처리량 증가
- CPU 대기 감소

주의:

- 너무 큰 배치는 메모리 사용 증가와 타임아웃 위험

## 실습 예제

```bash
# 개념 예시: redis-cli --pipe 모드
seq 1 1000 | awk '{print "SET pipe:test:"$1" "$1}' | redis-cli -p 6380 --pipe
```

애플리케이션에서는 클라이언트 라이브러리 파이프라인 API 사용을 권장합니다.

## 설계 포인트

- 배치 크기는 100~1000 범위에서 측정 후 결정(환경별 다름)
- 읽기/쓰기 혼합 배치보다 목적별 배치가 디버깅에 유리
- 실패 시 재시도 단위를 청크 기준으로 설계

추가 권장:

- 청크별 처리 시간, 실패율, 재시도율을 지표로 수집
- 대량 작업은 업무 시간대와 분리해 실행

## 자주 하는 실수

1. 파이프라인 크기를 무한히 키움
2. 실패 처리 없이 일괄 전송
3. 성능 측정 없이 기본값으로 운영

## 요약

- 파이프라이닝은 RTT를 줄여 Redis 처리량을 크게 높인다.
- 배치 크기는 성능과 안정성 사이에서 실측으로 정해야 한다.

## 연습문제

### 기초

1. 1000건 삽입을 일반 방식/파이프라인 방식으로 비교해보세요.
2. 배치 크기 100, 500, 1000의 체감 차이를 기록해보세요.

### 응용

1. 대량 캐시 워밍 작업의 배치 전략을 설계해보세요.
2. 파이프라인 실패 시 복구 정책을 작성해보세요.

## 챕터 체크리스트

- [x] 초안 작성 완료
- [x] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
