# Chapter 15 - SCAN vs KEYS, BigKey 대응

- 상태: 초안 완료
- 목표 분량: 11쪽

## 학습 목표

- `KEYS`가 운영 환경에서 위험한 이유를 설명할 수 있다.
- `SCAN` 기반 안전 조회 패턴을 적용할 수 있다.
- BigKey 탐지와 완화 전략을 수립할 수 있다.

## 핵심 개념

`KEYS pattern`은 전체 키 공간을 즉시 탐색합니다.
키 수가 많으면 서버 응답 지연을 크게 유발할 수 있습니다.

운영 장애에서 자주 보이는 패턴은
"점검용 임시 명령이 서비스 지연을 유발"하는 경우입니다.
`KEYS`는 개발 환경에서는 편하지만, 운영에서는 금지에 가깝게 관리해야 합니다.

`SCAN`은 점진적으로 일부 키를 반환해 부하를 분산합니다.

## 실습 예제

```bash
redis-cli -p 6380 SCAN 0 MATCH cache:* COUNT 100
```

반복 실행으로 cursor가 0이 될 때까지 순회합니다.

BigKey 관찰:

```bash
redis-cli -p 6380 --bigkeys
```

## 설계 포인트

- 운영 진단 도구는 항상 `SCAN` 기반으로 작성
- BigKey는 분할(샤딩 키), TTL, 구조 변경으로 완화
- 키 길이/값 크기/컬렉션 길이를 함께 모니터링

BigKey 완화 전형:

- 단일 거대 Hash -> 엔티티별 소형 Hash 분할
- 무제한 List -> 기간/페이지 키 분할 + trim
- 대형 String -> 필드 분리 또는 압축/포맷 재설계

## 자주 하는 실수

1. 운영 API에서 `KEYS *` 사용
2. BigKey를 발견하고도 구조 개선 없이 하드웨어만 확장
3. 큰 Hash/List/Set를 무기한 유지

## 요약

- `KEYS`는 편하지만 운영 위험이 크다.
- `SCAN` 습관과 BigKey 감시 체계가 필수다.
- 문제 키는 구조적으로 쪼개는 접근이 가장 효과적이다.

## 연습문제

### 기초

1. `SCAN`으로 특정 접두사 키를 순회해보세요.
2. `--bigkeys` 결과를 읽고 큰 키 1개를 분석해보세요.

### 응용

1. BigKey 개선안을 3가지 제시해보세요.
2. 운영 점검 스크립트에서 금지할 명령 목록을 작성해보세요.

## 챕터 체크리스트

- [x] 초안 작성 완료
- [x] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
