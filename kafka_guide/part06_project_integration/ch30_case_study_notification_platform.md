# Chapter 30 - 사례 연구: Notification Platform의 Kafka

- 상태: 초안 완료
- 목표 분량: 8쪽

## 학습 목표
- 프로젝트 맥락에서 Kafka 도입 포인트를 설명할 수 있다.
- 문제-개선-성과 흐름으로 사례를 정리할 수 있다.
- 재발 방지 운영 규칙을 도출할 수 있다.

## 프로젝트 맥락

이 레포는 API/Worker/Kafka 인프라가 함께 존재합니다.
Kafka는 비동기 처리와 확장성 확보를 위한 핵심 축으로 사용됩니다.

## 사례 요약
1. 문제: 동기 의존이 높아 피크 시간 지연 증가
2. 접근: 이벤트 기반 비동기 처리로 경로 분리
3. 이슈: 소비 지연, 재처리 정책 미흡, 운영 표준 부족
4. 개선: 토픽 정책 표준화, lag 모니터링, DLQ/런북 정착

## 전/후 지표(학습용 예시)

| 항목 | 개선 전 | 개선 후 | 해석 |
|---|---|---|---|
| API p95 응답시간 | 1,200ms | 430ms | 동기 의존 경로 분리 효과 |
| 피크 시간 consumer lag | 18,000 | 2,300 | 소비 병목 완화 + 모니터링 반영 |
| 재처리 성공률(24h) | 62% | 96% | DLQ 분리와 절차 표준화 효과 |
| 장애 감지-완화 평균 시간 | 22분 | 7분 | 런북/알림 체계 고정 효과 |

주의:
- 위 수치는 학습용 예시입니다.
- 실제 프로젝트에서는 동일 지표 정의로 전/후를 비교해야 합니다.

## 실패 1건 복기(예시)

1. 원인
- 외부 의존 API timeout 급증 + 재시도 정책 과도 설정

2. 완화
- 재시도 간격 확대, 비핵심 이벤트 임시 지연 처리

3. 복구
- 컨슈머 처리량 회복 확인 후 backlog 단계적 소진

4. 재발 방지
- timeout 경보 임계치 하향, 재시도 정책 상한 고정, 대응 문구 템플릿 추가

## 왜 Kafka였는가(대안 비교)

- 이벤트 재처리와 순차 소비가 필요해 로그형 저장소가 유리했습니다.
- 다수 소비자가 동일 이벤트를 독립 소비해야 했습니다.
- 단순 큐보다 offset/lag 관측, 재처리 운영성이 중요했습니다.
- 트래픽 피크를 흡수할 비동기 완충 계층이 필요했습니다.

## 설계 포인트
- 기술 도입 자체보다 운영 규칙 정립이 성과를 만든다.
- 지표 기반 회고를 정례화해야 개선이 누적된다.
- 계약/보장/장애 대응을 문서로 고정해야 팀 확장에 강하다.

운영 반영 체크리스트:
- 전/후 지표 정의를 PRD/런북에 함께 고정
- 실패 사례를 월 1회 복기하고 표준 절차에 반영
- 성능 개선과 장애 대응 지표를 같은 대시보드에서 관리

## 자주 하는 실수
1. Kafka 도입을 목표로 삼고 문제 정의를 생략
2. 성능 수치만 보고 운영 리스크를 무시
3. 실패 사례를 기록하지 않음

## 요약
- Kafka 사례의 핵심은 구조화된 운영 습관이다.
- 문제 정의-개선-재측정-표준화 사이클이 필요하다.

## 연습문제
### 기초
1. 사례의 문제-개선-성과를 10줄로 요약해보세요.
2. 운영 표준이 왜 중요한지 설명해보세요.

### 응용
1. 본인 프로젝트 Kafka 도입 체크리스트를 작성해보세요.
2. 장애 커뮤니케이션 문안을 작성해보세요.

## 예제 명령어 검증 시나리오(권장)

사전 조건:
- 전/후 비교 지표 정의(p95, lag, 재처리 성공률, 감지-완화 시간)
- 동일 부하 조건에서 측정 가능한 테스트 구간 확보

검증 절차:
1. 개선 전 상태에서 기준 지표 1주 수집
2. 개선안 적용(토픽 정책/모니터링/DLQ/런북)
3. 동일 조건 재측정 후 전/후 비교
4. 장애 드릴 1회 수행해 감지-완화 시간 측정

성공 기준:
- 핵심 지표가 목표 방향으로 개선(p95/lag 감소, 재처리 성공률 증가)
- 개선 효과가 단발성 이벤트가 아닌 반복 측정으로 재현
- 실패 사례와 대응 절차가 문서 표준으로 고정

## 챕터 체크리스트
- [x] 초안 작성 완료
- [ ] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [ ] 최종 교정 완료
