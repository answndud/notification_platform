# Chapter 11 - 스키마/직렬화 입문

- 상태: 초안 완료
- 목표 분량: 10쪽

## 학습 목표
- JSON/Avro/Protobuf의 차이를 설명할 수 있다.
- 스키마 호환성 전략을 선택할 수 있다.
- 이벤트 계약 변경 절차를 설계할 수 있다.

## 핵심 개념

이벤트는 코드보다 오래 살아남는 계약입니다.
직렬화 포맷과 스키마 버전 정책이 없으면
서비스가 늘어날수록 변경 비용이 폭발합니다.

## 직관 비교

```text
JSON       : 읽기 쉬움, 크기 큼, 스키마 강제 약함
Avro       : 크기 효율 좋음, 스키마 관리에 유리
Protobuf   : 성능/크기 효율 좋음, 계약 관리 필요
```

초보자 관점에서는 "사람이 읽기 쉬운지"보다
"변경할 때 안전한지"를 우선 기준으로 보는 것이 좋습니다.

## 실습 예제

```bash
# 스키마 레지스트리 환경이 준비되면
# subject 등록/호환성 검사 명령으로 검증
```

## 설계 포인트
- 변경은 backward compatibility 기준으로 시작한다.
- 필드 삭제보다 deprecate 전략을 우선 검토한다.
- 스키마 변경 PR에 소비자 영향 목록을 포함한다.

## 자주 하는 실수
1. 이벤트 스키마를 문서 없이 코드로만 관리
2. 필수 필드 변경을 강행해 하위 호환 깨짐
3. 직렬화 포맷 기준이 팀마다 다름

## 요약
- 이벤트 스키마는 기술 요소가 아니라 조직 계약이다.
- 호환성 정책이 없는 Kafka는 장기적으로 취약하다.

## 초보자 체크
- backward compatibility를 한 문장으로 설명할 수 있는가?
- 필드 추가/삭제 시 어떤 순서로 배포해야 하는지 말할 수 있는가?

## 연습문제
### 기초
1. JSON과 Avro 차이를 정리해보세요.
2. backward compatibility 의미를 설명해보세요.

### 응용
1. 이벤트 계약 변경 절차 템플릿을 작성해보세요.
2. 스키마 버전 정책(v1/v2) 롤아웃 계획을 세워보세요.

## 예제 명령어 검증 시나리오(권장)

사전 조건:
- `docker compose -f docker-compose.idea3.yml -f docker-compose.kafka-sr.yml up -d schema-registry`

검증 절차:
1. `./scripts/verify_kafka_schema_registry.sh` 실행
2. subject 등록과 호환성(BACKWARD) 설정 확인

성공 기준:
- Schema Registry 준비 완료
- `payment.events-value` subject 등록 완료
- 호환성 정책 설정 완료

## 챕터 체크리스트
- [x] 초안 작성 완료
- [x] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
