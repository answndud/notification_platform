# Chapter 18 - KRaft와 Controller Failover

- 상태: 초안 완료
- 목표 분량: 11쪽

## 학습 목표
- KRaft 구조를 개념적으로 설명할 수 있다.
- 컨트롤러 장애 전환 시나리오를 이해할 수 있다.
- 운영 체크포인트를 정리할 수 있다.

## 핵심 개념

KRaft는 ZooKeeper 없이 메타데이터를 관리하는 Kafka 모드입니다.
컨트롤러 선출/메타데이터 일관성이 핵심 운영 요소입니다.

## 실습 예제

```text
학습용 토폴로지: 3 controller quorum + broker 노드 구성
장애 실험: 활성 controller 중단 -> 새 controller 선출 시간 측정
```

## 설계 포인트
- 컨트롤러 quorum은 홀수 노드로 구성한다.
- 선출 시간과 메타데이터 전파 지연을 계측한다.
- 브로커 재시작/롤링 배포 절차를 문서화한다.

## 자주 하는 실수
1. quorum 설계 없이 단일 의존 구조 유지
2. 컨트롤러 장애 실험 미수행
3. 버전 업그레이드 절차 미정의

## 요약
- KRaft 운영은 컨트롤러 안정성이 핵심이다.
- 선출 시간과 전파 지연을 관측해야 안전하다.

## 연습문제
### 기초
1. KRaft와 ZooKeeper 기반 차이를 정리해보세요.
2. 컨트롤러 failover 시 확인 지표를 적어보세요.

### 응용
1. KRaft 운영 점검 체크리스트를 작성해보세요.
2. 롤링 배포 절차를 단계별로 설계해보세요.

## 예제 명령어 검증 시나리오(권장)

사전 조건:
- 3-controller quorum 구성 가정

검증 절차:
1. `./scripts/verify_kafka_kraft_failover_sim.sh` 실행
2. quorum 홀수 구성/선출 시간 목표 검증

성공 기준:
- quorum 조건(홀수) 만족
- failover 시간 목표(<=10초) 충족

## 챕터 체크리스트
- [x] 초안 작성 완료
- [x] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
