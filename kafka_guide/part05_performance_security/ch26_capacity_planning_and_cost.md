# Chapter 26 - 용량 계획과 비용

- 상태: 초안 완료
- 목표 분량: 9쪽

## 학습 목표
- 스토리지/네트워크 용량 산정 기준을 이해할 수 있다.
- 증설 시점을 판단할 수 있다.
- 비용 최적화 전략을 설계할 수 있다.

## 핵심 개념

Kafka 비용은 보관량(retention), 복제 계수, 트래픽 처리량에 크게 좌우됩니다.
평균 트래픽만 기준으로 설계하면 피크 구간에 장애가 발생합니다.

## 실습 예제

실습 목적: 토픽 보관 정책과 복제 배수가 저장소 비용에 주는 영향을 수치로 계산합니다.

```text
일일 메시지량 * 평균 메시지 크기 * retention 일수 * 복제 배수
+ 운영 여유율(20~30%)
```

예상 결과/관찰 포인트:
- retention 2배 증가는 저장소 비용도 거의 2배로 증가합니다.
- replication.factor 증가는 내구성과 비용을 동시에 증가시킵니다.
- 평균 트래픽 기반 계산은 피크 구간 장애를 숨길 수 있습니다.

## 실패 시 확인 항목

1. 단위 계산 오류
- 증상: 용량 산정이 과소/과대 추정됨
- 확인: bytes/KB/MB/GB 단위 변환 일관성 점검

2. 피크 트래픽 누락
- 증상: 평시에는 정상, 피크에 디스크 임계치 급접근
- 확인: 평균값 외 p95/p99 트래픽 반영 여부 점검

3. 비용 항목 누락
- 증상: 인프라 견적과 실제 청구 차이 확대
- 확인: 스토리지/네트워크/운영 여유율 포함 여부 점검

## 설계 포인트
- 토픽별 보관기간을 차등화해 비용을 최적화한다.
- 압축/compression 적용 여부를 비용과 함께 검토한다.
- 증설 임계치를 지표로 명확히 정의한다.

운영 반영 체크리스트:
- 토픽별 retention과 복제 정책을 표로 관리
- 월 1회 실제 사용량과 산정치 오차 검토
- 증설 조건(디스크 사용률, lag, 지연) 수치로 고정

## 자주 하는 실수
1. retention 증가의 비용 영향을 과소평가
2. 복제 계수 비용 누락
3. 증설 기준 없이 장애 후 대응만 반복

## 요약
- 용량 계획은 수치 계산 + 운영 리스크 관리다.
- 보관정책과 복제정책이 비용의 핵심이다.

## 연습문제
### 기초
1. 토픽 2개 가정 용량을 계산해보세요.
2. retention 정책에 따른 비용 차이를 비교해보세요.

### 응용
1. 6개월 성장 시나리오 증설 계획을 작성해보세요.
2. 비용 절감 우선순위(정책/아키텍처)를 제시해보세요.

## 예제 명령어 검증 시나리오(권장)

사전 조건:
- Python 3 실행 가능

검증 절차:
1. `./scripts/verify_kafka_capacity_calc.sh` 실행
2. raw 용량과 headroom 포함 용량을 시나리오별로 확인

성공 기준:
- 시나리오별 용량 계산값이 출력됨
- headroom(20~30%) 반영 전/후 값이 모두 확인됨

## 챕터 체크리스트
- [x] 초안 작성 완료
- [x] 예제 명령어 검증 완료
- [x] 초보자 기준 용어 설명 완료
- [x] 최종 교정 완료
